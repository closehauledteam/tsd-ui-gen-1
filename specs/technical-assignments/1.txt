1. Љраткое описание продуктаЊобильное приложение длЯ мониторинга и учЮта фитозаболеваний растений (в теплице/поле).Љлючевые возможности: создание записей о заболеваниЯх (текстом / голосом), фото, список записей, детальнаЯ карточка, карта/таб/сортировка, управление статусом и ответственными. €нтерфейсы уже реализованы в виде React-компонентов: форма мониторинга (DiseaseMonitoring), вкладка со списком/картой заболеваний (DiseaseMapTab) и детальнаЯ страница записи (DiseaseDetailsPage). DiseaseMonitoringDiseaseMapTabDiseaseDetailsPage’ребование ключевое: приложение должно быть offline-first С работать автономно (создание/редактирование/просмотр записей и фото) и корректно синхронизировать данные при восстановлении сети.2. –ели и критерии успеха* Ћбеспечить непрерывную работу сотрудников в полевых условиЯх без доступа к сети.* Њинимизировать потерю данных (0% потерЯнных пользовательских записей/фото при переключении offline?online).* Ћбеспечить понЯтную индикацию статуса синхронизации и конфликтов.* Њетрики успеха: % операций, выполненных offline; времЯ синхронизации средней записи; error-rate sync.3. Џользовательские роли* Ђгроном / Џолевой специалист С создаЮт записи, фотографирует, назначает ответственных.* Њенеджер / ’ехник С просматривает список, видит карту, отмечает как ЗвылеченоИ, создаЮт задачи.* ‘истема (сервер) С принимает синхронизацию, выполнЯет валидацию и предоставлЯет обновлениЯ.4. Љлючевой функционал (епики + фичи)Epic A С ‡апись мониторинга (функции из DiseaseMonitoring)* ”орма созданиЯ записи (блок, рЯд, гибрид, заболевание, степень, заметки, проблемы, фото). DiseaseMonitoring* ‚вод голосом + текстом (интерфейс кнопок есть). DiseaseMonitoring* Џоддержка загрузки нескольких фото, предпросмотра и удалениЯ фото перед отправкой. DiseaseMonitoringOffline требованиЯ* ‘оздание записи и прикрепление фото С полностью локально (локальное хранилище + очередь синхронизации).* ”ото сохранЯютсЯ в локальном файловом хранилище (файловаЯ система устройства) и привЯзываютсЯ к локальному ID записи.* UI: чЮткаЯ индикациЯ статуса записи С pending-sync, synced, failed.Epic B С Џросмотр и навигациЯ по записЯм (функции из DiseaseMapTab)* ‘писок/карточки с фильтрами и сортировкой по активности/тЯжести/датам. DiseaseMapTab* Ћткрытие детальной страницы записи. ‘охранение выбранного ID (уже используетсЯ sessionStorage в веб-коде С в RN использовать AsyncStorage/secure store). DiseaseMapTabOffline требованиЯ* Љеш последних N записей и метаданных доступен офлайн.* Џри отсутствии сети С показать закешированные данные и пометить устаревшими (timestamp).Epic C С „етальнаЯ запись (функции DiseaseDetailsPage)* Џоказ основной информации, заметок, галереи фото, кнопки редактированиЯ/созданиЯ задачи. DiseaseDetailsPageOffline требованиЯ* ѓалереЯ должна показывать локальные/скачанные превью фото.* ђедактирование С работать офлайн; изменениЯ помещаютсЯ в sync-очередь.Epic D С ‘инхронизациЯ (core)* „вустороннЯЯ синхронизациЯ (pull updates + push local changes).* Њодель синхронизации: operation log (очередь CRUD операций) + periodic/triggered sync.* Љонфликты: детальное правило разрешениЯ (см. раздел 7).* ’ранзакционнаЯ отправка фото + метаданных (чтобы не потерЯть свЯзь).Epic E С Ѓезопасность и доступ* ЂутентификациЯ пользователЯ (JWT / refresh).* ‹окальное шифрование фото/данных при необходимости.* ђоли и права длЯ действий (создание/редактирование/удаление/изменение статуса).5. Ќефункциональные требованиЯ* Offline-first: все основные операции С І1s локально.* ЌадЮжность: данные не терЯютсЯ при принудительном закрытии приложениЯ.* Џроизводительность: визуализациЯ списка до 1000 записей С плавнаЯ прокрутка (виртуализациЯ).* •ранилище: фото до X ЊЃ (политика ротации/удалениЯ старых кешированных фото).* Џлатформы: iOS & Android (React Native).* ‹окализациЯ: RU (UI в компонентах на русском). DiseaseMonitoring6. Acceptance Criteria (по каждой ключевой фиче)* ‘оздание записи офлайн: при создании записи без сети она сохранЯетсЯ локально, помечаетсЯ pending-sync, UI показывает статус; при восстановлении сети запись синхронизируетсЯ на сервер и получает серверный ID.* ”ото: фотографии, сделанные офлайн, сохранЯютсЯ и корректно загружаютсЯ на сервер при синке; в журнале операций свЯзываютсЯ с записью.* Џросмотр списка офлайн: последние 7 дней записей доступны без сети; видно статус синхронизации и дату последнего обновлениЯ.* Љонфликты: если запись была изменена и на сервере и локально С приложение показывает конфликт и предоставлЯет два варианта: оставить локальную версию, принЯть серверную, или ручное слиЯние (поле за полем).* ‘табильность: 0 критических падений при создании/синхронизации 100 тестовых записей с фото (тест-акцепт).7. ‘инхронизациЯ и разрешение конфликтов (техническаЯ стратегиЯ)7.1 Њодель данных / id* ‹окальные записи получают временный localId (UUID). Џосле успешного push сервер возвращает serverId и serverVersion (или updatedAt). Ќужно сохранЯть свЯзь localId ? serverId.* „лЯ каждой записи хранить: localId, serverId?, lastLocalChangeAt, lastServerChangeAt, syncStatus (pending, inProgress, synced, failed), version/etag.7.2 Ћчередь операций (operation log)* ‹окально логируютсЯ операции: create, update, delete, uploadPhoto.* Ћчередь выполнЯетсЯ последовательно; при ошибке С retry с backoff и флагом failed длЯ ручной обработки.7.3 Push / Pull* Push: отправлЯем batched операции (например, до 20 записей/опер.) вместе с метаданными и multipart длЯ фото. Ћтвет сервера должен возвращать mapping {localId -> serverId, status, serverTimestamp}.* Pull: запрашиваем изменениЯ с сервера по since=lastSyncAt длЯ минимального трафика.7.4 ђазрешение конфликтов* ‚ерсиЯ/etag-based: если serverVersion > localVersion и локальные изменениЯ есть С считаетсЯ конфликт.* UI: показывать экран конфликта с отличиЯми полей (текст, фото, severity). Џользователь выбирает С локально или серверно, или ручное слиЯние.* Ђвтоматическое правило (по умолчанию): последнЯЯ запись по времени wins длЯ полей без критических последствий; длЯ фото С объединЯть. џвные бизнес-полЯ (степень поражениЯ, статус) требуют manual confirmation.8. Data model (предложение С сокращЮнно)DiseaseRecord {  localId: string,  serverId?: number,  block?: string,  row: string,  hybrid: string,  disease: string,  severity: "ЌизкаЯ"|"‘реднЯЯ"|"‚ысокаЯ",  notes?: string,  status?: "active"|"inactive",  createdBy?: string,  responsibleUser?: string,  createdDate: string,  resolvedDate?: string,  problemsList?: string[],  photos: [    { localPath: string, serverUrl?: string, uploadStatus: "pending"|"uploaded"|"failed" }  ],  lastLocalChangeAt: string,  lastServerChangeAt?: string,  syncStatus: "pending"|"inProgress"|"synced"|"failed"}(модель частично отражает полЯ из DiseaseMonitoring/DiseaseMapTab/DiseaseDetailsPage). DiseaseMonitoringDiseaseMapTabDiseaseDetailsPage9. API С примеры endpointХов (контракт)* POST /sync/push С принимает batch операций {operations: [...]}; возвращает mapping локальных ? серверных ID.* GET /sync/pull?since=TIMESTAMP С возвращает обновлениЯ.* POST /records С создание (альтернатива push).* PUT /records/{id} С обновление.* POST /records/{id}/photos С загрузка фото (multipart).* GET /records?block=...&since=... С список/фильтрациЯ.Ћтветы API должны содержать version или updatedAt длЯ поддержки конфликт-детекции.10. UX / UI требованиЯ (высокоуровнево)* ‘татус синхронизации С видимый бейдж в карточке и глобальный индикатор в шапке (last sync, pending count).* Љнопка "‘инхронизировать сейчас" + автоматическаЯ синхронизациЯ при поЯвлении сети.* Ћтображать прогресс загрузки фото (spinner + %).* ‚ списке DiseaseMapTab С сортировка и пометка вылеченных/активных; при клике открывать детально. DiseaseMapTab* ‚ детальной С галереЯ фотографий с возможностью просмотра локальных копий. DiseaseDetailsPage11. Ѓезопасность и приватность* Џередача по HTTPS.* ‹окальное шифрование при хранении фото/чувств. данных (на уровне файловой системы или DB encryption).* ЂвторизациЯ: токены с refresh.* ЊинимизациЯ личных данных в логах.12. ’естирование (acceptance & e2e)* Unit-тесты длЯ sync-модулЯ (моделирование offline?online?conflict).* E2E сценарии: создание 50 записей офлайн с фото, восстановление сети, проверка корректности serverId mapping.* UI тесты: индикациЯ статусов, обработка ошибок при загрузке фото, ручное разрешение конфликтов.* Ќагрузочное тестирование API sync (batching).13. Rollout / миграциЯ данных* …сли есть существующаЯ веб-версиЯ (судЯ по sessionStorage в коде), предусмотреть миграцию: map session storage ? RN AsyncStorage/DB. DiseaseMapTab* Њеханизм Зsoft syncИ при первом запуске С pull последних записей и reconcile.14. ђабочаЯ разбивка (эпики ? задачи) С кратко1. Ђрхитектура offline: выбрать локальную Ѓ„ (Realm / SQLite / WatermelonDB).2. Њодуль хранениЯ файлов/фото (локальный FS + thumbnail generation).3. Ћчередь операций и sync-engine.4. €нтеграциЯ с существующими UI-компонентами (DiseaseMonitoring, DiseaseMapTab, DiseaseDetailsPage) С адаптациЯ длЯ RN. DiseaseMonitoringDiseaseMapTabDiseaseDetailsPage5. UI длЯ синхронизации и конфликтов.6. Ѓезопасность / авторизациЯ.7. ’естирование и запуск.DiseaseDetailsPage.tsximport { Card } from "./ui/card";import { Button } from "./ui/button";import { Badge } from "./ui/badge";import { AlertTriangle, ArrowLeft, MapPin, Calendar, User, FileText } from "lucide-react";import { BackButton } from "./BackButton";import { ImageWithFallback } from "./figma/ImageWithFallback";interface DiseaseDetailsPageProps {К onPageChange: (page: string) => void;К diseaseRecord?: {К К id: number;К К row: string;К К hybrid: string;К К disease: string;К К severity: string;К К date: string;К К notes?: string;К };}export function DiseaseDetailsPage({ onPageChange, diseaseRecord }: DiseaseDetailsPageProps) {К // Њок данные если запись не переданаК const record = diseaseRecord || {К К id: 1,К К row: "ђЯд 12",К К hybrid: "’омат F1 Џинк Џарадайз",К К disease: "”итофтороз",К К severity: "‘реднЯЯ",К К date: "2024-01-15",К К notes: "Џоражение листьев, начальнаЯ стадиЯ развитиЯ заболеваниЯ. Ќеобходимо принЯть меры по локализации очага."К };К const getSeverityColor = (severity: string) => {К К switch (severity) {К К К case "ЌизкаЯ":К К К К return "bg-green-100 text-green-800";К К К case "‘реднЯЯ":К К К К return "bg-yellow-100 text-yellow-800";К К К case "‚ысокаЯ":К К К К return "bg-red-100 text-red-800";К К К default:К К К К return "bg-gray-100 text-gray-800";К К }К };К const photos = [К К "https://images.unsplash.com/photo-1592477725143-2e57dc728f5a?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHx0b21hdG8lMjBkaXNlYXNlJTIwcGxhbnQlMjBsZWF2ZXN8ZW58MXx8fHwxNzU3NTIwOTA3fDA&ixlib=rb-4.1.0&q=80&w=1080",К К "https://images.unsplash.com/photo-1578066750177-8e6ad2b6f6f9?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwyfHx0b21hdG8lMjBkaXNlYXNlJTIwcGxhbnQlMjBsZWF2ZXN8ZW58MXx8fHwxNzU3NTIwOTA3fDA&ixlib=rb-4.1.0&q=80&w=1080",К К "https://images.unsplash.com/photo-1623509094804-509fd6d3e1ab?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwzfHx0b21hdG8lMjBkaXNlYXNlJTIwcGxhbnQlMjBsZWF2ZXN8ZW58MXx8fHwxNzU3NTIwOTA3fDA&ixlib=rb-4.1.0&q=80&w=1080"К ];К return (К К <div className="min-h-screen bg-background pb-20 relative">К К К <BackButton onBack={() => onPageChange('plant-protection')} />К К К <div className="px-4 py-6">К К К К <div className="mb-6 pt-12">К К К К К <div className="flex items-center space-x-3 mb-2">К К К К К К <div className="bg-red-100 dark:bg-red-900/30 rounded-full p-2">К К К К К К К <AlertTriangle className="text-red-600 dark:text-red-400" size={20} />К К К К К К </div>К К К К К К <h1 className="text-2xl">{record.disease}</h1>К К К К К </div>К К К К К <p className="text-muted-foreground text-sm">„етальнаЯ информациЯ о заболевании</p>К К К К </div>К К К К <div className="space-y-6">К К К К К {/* Main info */}К К К К К <Card className="p-4">К К К К К К <h3 className="text-lg mb-4">ЋсновнаЯ информациЯ</h3>К К К К К К <div className="space-y-4">К К К К К К К <div className="flex items-center justify-between">К К К К К К К К <div className="flex items-center space-x-3">К К К К К К К К К <MapPin className="text-muted-foreground" size={16} />К К К К К К К К К <span className="text-sm font-semibold">Њестоположение:</span>К К К К К К К К </div>К К К К К К К К <span className="text-sm font-normal">{record.row}</span>К К К К К К К </div>К К К К К К К К К К К К К К <div className="flex items-center justify-between">К К К К К К К К <div className="flex items-center space-x-3">К К К К К К К К К <div className="w-4 h-4 bg-green-500 rounded-full"></div>К К К К К К К К К <span className="text-sm font-semibold">ѓибрид:</span>К К К К К К К К </div>К К К К К К К К <span className="text-sm font-normal">{record.hybrid}</span>К К К К К К К </div>К К К К К К К К К К К К К К <div className="flex items-center justify-between">К К К К К К К К <div className="flex items-center space-x-3">К К К К К К К К К <Calendar className="text-muted-foreground" size={16} />К К К К К К К К К <span className="text-sm font-semibold">„ата выЯвлениЯ:</span>К К К К К К К К </div>К К К К К К К К <span className="text-sm font-normal">{record.date}</span>К К К К К К К </div>К К К К К К К К К К К К К К <div className="flex items-center justify-between">К К К К К К К К <div className="flex items-center space-x-3">К К К К К К К К К <AlertTriangle className="text-muted-foreground" size={16} />К К К К К К К К К <span className="text-sm font-semibold">‘тепень поражениЯ:</span>К К К К К К К К </div>К К К К К К К К <Badge className={getSeverityColor(record.severity)}>К К К К К К К К К {record.severity}К К К К К К К К </Badge>К К К К К К К </div>К К К К К К </div>К К К К К </Card>К К К К К {/* Notes */}К К К К К {record.notes && (К К К К К К <Card className="p-4">К К К К К К К <h3 className="text-lg mb-3">‡аметки</h3>К К К К К К К <div className="flex items-start space-x-3">К К К К К К К К <FileText className="text-muted-foreground mt-1" size={16} />К К К К К К К К <p className="text-sm leading-relaxed">{record.notes}</p>К К К К К К К </div>К К К К К К </Card>К К К К К )}К К К К К {/* Photo gallery */}К К К К К <Card className="p-4">К К К К К К <h3 className="text-lg mb-4">”отографии</h3>К К К К К К <div className="grid grid-cols-1 gap-4">К К К К К К К {photos.map((photo, index) => (К К К К К К К К <div key={index} className="aspect-video rounded-lg overflow-hidden">К К К К К К К К К <ImageWithFallbackК К К К К К К К К К src={photo}К К К К К К К К К К alt={`”ото заболеваниЯ ${index + 1}`}К К К К К К К К К К className="w-full h-full object-cover"К К К К К К К К К />К К К К К К К К </div>К К К К К К К ))}К К К К К К </div>К К К К К </Card>К К К К К {/* Action buttons */}К К К К К <div className="space-y-3">К К К К К К <Button К К К К К К К className="w-full h-12 bg-orange-600 hover:bg-orange-700 touch-target"К К К К К К К onClick={() => {К К К К К К К К // ‹огика редактированиЯ записиК К К К К К К }}К К К К К К >К К К К К К К ђедактировать записьК К К К К К </Button>К К К К К К <Button К К К К К К К variant="outline"К К К К К К К className="w-full h-12 touch-target"К К К К К К К onClick={() => {К К К К К К К К // ‹огика созданиЯ задачи на основе этой записиК К К К К К К }}К К К К К К >К К К К К К К ‘оздать задачу на основе записиК К К К К К </Button>К К К К К </div>К К К К </div>К К К </div>К К </div>К );}DiseaseMapTab.tsximport { Card } from "./ui/card";import { Badge } from "./ui/badge";import { AlertTriangle, CheckCircle, Clock } from "lucide-react";import { useTelegramWebApp } from "../hooks/useTelegramWebApp";interface DiseaseMapTabProps {К selectedBlock: string;К onPageChange: (page: string) => void;}interface Disease {К id: number;К name: string;К discoveryDate: string;К recoveryDate?: string;К initiator: string;К responsible: string;К affectedRows: string;К severity: "high" | "medium" | "low";К completedTreatments: number;К plannedTreatments: number;}const mockDiseases: Disease[] = [К {К К id: 1,К К name: "”итофтороз",К К discoveryDate: "2025-01-15",К К initiator: "Џетров €.€.",К К responsible: "‘идоров Џ.Џ.",К К affectedRows: "1-15, 20-25",К К severity: "high",К К completedTreatments: 2,К К plannedTreatments: 3К },К {К К id: 2,К К name: "ЊучнистаЯ роса",К К discoveryDate: "2025-01-18",К К initiator: "€ванов Ђ.Ђ.",К К responsible: "Љозлов ‚.‚.",К К affectedRows: "30-40",К К severity: "medium",К К completedTreatments: 1,К К plannedTreatments: 2К },К {К К id: 3,К К name: "’лЯ",К К discoveryDate: "2025-01-20",К К initiator: "Љозлов ‚.‚.",К К responsible: "Џетров €.€.",К К affectedRows: "5-8",К К severity: "high",К К completedTreatments: 0,К К plannedTreatments: 2К },К {К К id: 4,К К name: "‘ераЯ гниль",К К discoveryDate: "2025-01-10",К К recoveryDate: "2025-01-22",К К initiator: "‘идоров Џ.Џ.",К К responsible: "€ванов Ђ.Ђ.",К К affectedRows: "45-50",К К severity: "low",К К completedTreatments: 3,К К plannedTreatments: 0К },К {К К id: 5,К К name: "Ѓелокрылка",К К discoveryDate: "2025-01-12",К К recoveryDate: "2025-01-20",К К initiator: "Џетров €.€.",К К responsible: "‘идоров Џ.Џ.",К К affectedRows: "60-65",К К severity: "medium",К К completedTreatments: 2,К К plannedTreatments: 0К }];export function DiseaseMapTab({ selectedBlock, onPageChange }: DiseaseMapTabProps) {К const { hapticFeedback } = useTelegramWebApp();К // ‘ортировка: активные (без даты выздоровлениЯ) по тЯжести, затем вылеченныеК const sortedDiseases = [...mockDiseases].sort((a, b) => {К К // ‘начала активные болезниК К if (!a.recoveryDate && b.recoveryDate) return -1;К К if (a.recoveryDate && !b.recoveryDate) return 1;К К // …сли обе активные - сортируем по тЯжестиК К if (!a.recoveryDate && !b.recoveryDate) {К К К const severityOrder = { high: 0, medium: 1, low: 2 };К К К return severityOrder[a.severity] - severityOrder[b.severity];К К }К К // …сли обе вылеченные - по дате выздоровлениЯ (новые первые)К К return (b.recoveryDate || "").localeCompare(a.recoveryDate || "");К });К const getSeverityColor = (severity: string) => {К К switch (severity) {К К К case "high": return "bg-red-100 text-red-800";К К К case "medium": return "bg-yellow-100 text-yellow-800";К К К case "low": return "bg-green-100 text-green-800";К К К default: return "bg-gray-100 text-gray-800";К К }К };К const getSeverityText = (severity: string) => {К К switch (severity) {К К К case "high": return "‚ысокаЯ";К К К case "medium": return "‘реднЯЯ";К К К case "low": return "ЌизкаЯ";К К К default: return "Ќеизвестно";К К }К };К const handleDiseaseClick = (diseaseId: number) => {К К hapticFeedback("light");К К // ‘охранЯем ID выбранной болезни длЯ детальной страницыК К sessionStorage.setItem("selectedDiseaseId", diseaseId.toString());К К onPageChange("plant-disease-detail");К };К return (К К <div className="space-y-3">К К К {sortedDiseases.length === 0 ? (К К К К <Card className="p-6 text-center">К К К К К <CheckCircle className="mx-auto mb-3 text-green-600" size={48} />К К К К К <h3 className="mb-1">‡аболеваний не обнаружено</h3>К К К К К <p className="text-sm text-muted-foreground">К К К К К К ‚ выбранном блоке нет активных заболеванийК К К К К </p>К К К К </Card>К К К ) : (К К К К sortedDiseases.map((disease) => (К К К К К <CardК К К К К К key={disease.id}К К К К К К className="p-4 cursor-pointer hover:shadow-md transition-shadow"К К К К К К onClick={() => handleDiseaseClick(disease.id)}К К К К К >К К К К К К <div className="flex items-start gap-3">К К К К К К К <divК К К К К К К К className={`rounded-full p-2 flex-shrink-0 ${К К К К К К К К К disease.recoveryDateК К К К К К К К К К ? "bg-gray-100"К К К К К К К К К К : disease.severity === "high"К К К К К К К К К К ? "bg-red-100"К К К К К К К К К К : disease.severity === "medium"К К К К К К К К К К ? "bg-yellow-100"К К К К К К К К К К : "bg-green-100"К К К К К К К К }`}К К К К К К К >К К К К К К К К {disease.recoveryDate ? (К К К К К К К К К <CheckCircle className="text-gray-600" size={20} />К К К К К К К К ) : (К К К К К К К К К <AlertTriangleК К К К К К К К К К className={К К К К К К К К К К К disease.severity === "high"К К К К К К К К К К К К ? "text-red-600"К К К К К К К К К К К К : disease.severity === "medium"К К К К К К К К К К К К ? "text-yellow-600"К К К К К К К К К К К К : "text-green-600"К К К К К К К К К К }К К К К К К К К К К size={20}К К К К К К К К К />К К К К К К К К )}К К К К К К К </div>К К К К К К К <div className="flex-1 min-w-0">К К К К К К К К <div className="flex items-start justify-between mb-2">К К К К К К К К К <div>К К К К К К К К К К <h4 className="text-base">{disease.name}</h4>К К К К К К К К К К <p className="text-xs text-muted-foreground">К К К К К К К К К К К ђЯды: {disease.affectedRows}К К К К К К К К К К </p>К К К К К К К К К </div>К К К К К К К К К <Badge className={`${getSeverityColor(disease.severity)} text-xs`}>К К К К К К К К К К {getSeverityText(disease.severity)}К К К К К К К К К </Badge>К К К К К К К К </div>К К К К К К К К <div className="space-y-1 text-xs text-muted-foreground mb-2">К К К К К К К К К <div>К К К К К К К К К К <span className="text-gray-500">Ћбнаружено:</span>{" "}К К К К К К К К К К {new Date(disease.discoveryDate).toLocaleDateString("ru-RU")}К К К К К К К К К </div>К К К К К К К К К {disease.recoveryDate && (К К К К К К К К К К <div className="text-green-600">К К К К К К К К К К К <span className="text-gray-500">‚ылечено:</span>{" "}К К К К К К К К К К К {new Date(disease.recoveryDate).toLocaleDateString("ru-RU")}К К К К К К К К К К </div>К К К К К К К К К )}К К К К К К К К К <div>К К К К К К К К К К <span className="text-gray-500">€нициатор:</span> {disease.initiator}К К К К К К К К К </div>К К К К К К К К К <div>К К К К К К К К К К <span className="text-gray-500">Ћтветственный:</span>{" "}К К К К К К К К К К {disease.responsible}К К К К К К К К К </div>К К К К К К К К </div>К К К К К К К К <div className="flex items-center gap-3 text-xs">К К К К К К К К К <div className="flex items-center gap-1">К К К К К К К К К К <CheckCircle size={12} className="text-green-600" />К К К К К К К К К К <span className="text-muted-foreground">К К К К К К К К К К К ‚ыполнено: {disease.completedTreatments}К К К К К К К К К К </span>К К К К К К К К К </div>К К К К К К К К К <div className="flex items-center gap-1">К К К К К К К К К К <Clock size={12} className="text-orange-600" />К К К К К К К К К К <span className="text-muted-foreground">К К К К К К К К К К К ‡апланировано: {disease.plannedTreatments}К К К К К К К К К К </span>К К К К К К К К К </div>К К К К К К К К </div>К К К К К К К </div>К К К К К К </div>К К К К К </Card>К К К К ))К К К )}К К </div>К );}DiseaseMonitoring.tsximport { useState } from "react";import { Card } from "./ui/card";import { Button } from "./ui/button";import { Input } from "./ui/input";import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "./ui/select";import { Badge } from "./ui/badge";import { Textarea } from "./ui/textarea";import { AlertTriangle, Plus, Eye, Mic, Camera, Upload, User, Calendar } from "lucide-react";import { useTelegramWebApp } from "../hooks/useTelegramWebApp";interface DiseaseRecord {К id: number;К row: string;К hybrid: string;К disease: string;К severity: string;К date: string;К notes?: string;К status?: string;К createdBy?: string;К responsibleUser?: string;К resolvedDate?: string;К problemsList?: string[];}interface DiseaseMonitoringProps {К onAddRecord: (record: Omit<DiseaseRecord, 'id' | 'date'>) => void;К onViewDetails?: (record: DiseaseRecord) => void;К records?: DiseaseRecord[];}export function DiseaseMonitoring({ К onAddRecord,К onViewDetails,К records = [К К {К К К id: 1,К К К row: "ђЯд 12",К К К hybrid: "’омат F1 Џинк Џарадайз",К К К disease: "”итофтороз",К К К severity: "‘реднЯЯ",К К К date: "2024-01-15",К К К notes: "Џоражение листьев",К К К status: "active",К К К createdBy: "Џетров €.€.",К К К responsibleUser: "‘идоров Џ.Џ.",К К К problemsList: ["ЏЯтна на листьЯх", "“вЯдание"]К К }К ]}: DiseaseMonitoringProps) {К const [showForm, setShowForm] = useState(false);К const [formData, setFormData] = useState({К К block: '',К К row: '',К К hybrid: '',К К disease: '',К К severity: '',К К notes: '',К К photos: [] as File[],К К status: 'active',К К createdBy: '’екущий пользователь',К К responsibleUser: '',К К createdDate: new Date().toISOString().split('T')[0],К К resolvedDate: '',К К problemsList: [] as string[]К });К const { hapticFeedback } = useTelegramWebApp();К const diseases = [К К "”итофтороз",К К "ЊучнистаЯ роса",К К "‘ераЯ гниль",К К "—ернаЯ ножка",К К "”узариозное увЯдание",К К "‚ершиннаЯ гниль",К К "Ђльтернариоз",К К "Љладоспориоз"К ];К const severityLevels = [К К { value: "ЌизкаЯ", color: "bg-green-100 text-green-800" },К К { value: "‘реднЯЯ", color: "bg-yellow-100 text-yellow-800" },К К { value: "‚ысокаЯ", color: "bg-red-100 text-red-800" }К ];К const hybrids = [К К "’омат F1 Џинк Џарадайз",К К "’омат F1 Ѓиф Њастер",К К "Ћгурец F1 Њаша",К К "Ћгурец F1 ѓерман",К К "Џерец F1 ЉалифорниЯ",К К "Ѓаклажан F1 Љлоринда"К ];К const users = [К К "Џетров €.€.",К К "‘идоров Џ.Џ.",К К "€ванов Ђ.Ђ.",К К "Љозлов ‚.‚."К ];К const commonProblems = [К К "ЏЯтна на листьЯх",К К "“вЯдание",К К "„еформациЯ плодов",К К "€зменение цвета",К К "ѓниение корней",К К "‡асыхание листьев"К ];К const handleSubmit = () => {К К if (formData.block && formData.row && formData.hybrid && formData.disease && formData.severity) {К К К onAddRecord({К К К К row: `${formData.block}, ${formData.row}`,К К К К hybrid: formData.hybrid,К К К К disease: formData.disease,К К К К severity: formData.severity,К К К К notes: formData.notes,К К К К status: formData.status,К К К К createdBy: formData.createdBy,К К К К responsibleUser: formData.responsibleUser,К К К К resolvedDate: formData.resolvedDate,К К К К problemsList: formData.problemsListК К К });К К К setFormData({ К К К К block: '', К К К К row: '', К К К К hybrid: '', К К К К disease: '', К К К К severity: '', К К К К notes: '', К К К К photos: [],К К К К status: 'active',К К К К createdBy: '’екущий пользовател??',К К К К responsibleUser: '',К К К К createdDate: new Date().toISOString().split('T')[0],К К К К resolvedDate: '',К К К К problemsList: []К К К });К К К setShowForm(false);К К К hapticFeedback('success');К К }К };К const handlePhotoUpload = (event: React.ChangeEvent<HTMLInputElement>) => {К К const files = Array.from(event.target.files || []);К К setFormData(prev => ({К К К ...prev,К К К photos: [...prev.photos, ...files]К К }));К К hapticFeedback('light');К };К const removePhoto = (index: number) => {К К setFormData(prev => ({К К К ...prev,К К К photos: prev.photos.filter((_, i) => i !== index)К К }));К К hapticFeedback('light');К };К const toggleProblem = (problem: string) => {К К setFormData(prev => ({К К К ...prev,К К К problemsList: prev.problemsList.includes(problem) К К К К ? prev.problemsList.filter(p => p !== problem)К К К К : [...prev.problemsList, problem]К К }));К };К const getSeverityColor = (severity: string) => {К К const level = severityLevels.find(l => l.value === severity);К К return level?.color || "bg-gray-100 text-gray-800";К };К return (К К <div className="space-y-4">К К К {/* Header */}К К К <Card className="p-3 sm:p-4">К К К К <h3 className="mb-3">‘оздать мониторинг</h3>К К К К <div className="grid grid-cols-2 gap-2 sm:gap-3">К К К К К <ButtonК К К К К К onClick={() => {К К К К К К К setShowForm(!showForm);К К К К К К К hapticFeedback('light');К К К К К К }}К К К К К К className="h-14 sm:h-16 bg-green-600 hover:bg-green-700 touch-target"К К К К К >К К К К К К <div className="text-center">К К К К К К К <Plus className="mx-auto mb-1" size={20} />К К К К К К К <div className="text-sm">’екстом</div>К К К К К К </div>К К К К К </Button>К К К К К <ButtonК К К К К К onClick={() => {К К К К К К К // ‹огика голосового созданиЯК К К К К К К hapticFeedback('light');К К К К К К }}К К К К К К className="h-14 sm:h-16 bg-gradient-warm text-white hover:shadow-lg transition-shadow touch-target"К К К К К >К К К К К К <div className="text-center">К К К К К К К <Mic className="mx-auto mb-1" size={20} />К К К К К К К <div className="text-sm">ѓолосом</div>К К К К К К </div>К К К К К </Button>К К К К </div>К К К </Card>К К К {/* Add form */}К К К {showForm && (К К К К <Card className="p-4">К К К К К <h4 className="text-sm mb-3">ЌоваЯ запись о заболевании</h4>К К К К К <div className="space-y-3">К К К К К К <div className="grid grid-cols-2 gap-3">К К К К К К К <div>К К К К К К К К <label className="text-xs text-muted-foreground font-semibold">Ѓлок</label>К К К К К К К К <Select onValueChange={(value) => setFormData({ ...formData, block: value })}>К К К К К К К К К <SelectTrigger className="text-sm">К К К К К К К К К К <SelectValue placeholder="Ѓлок" className="text-xs text-muted-foreground/70 font-light" />К К К К К К К К К </SelectTrigger>К К К К К К К К К <SelectContent>К К К К К К К К К К <SelectItem value="Ѓлок Ђ" className="text-sm">Ѓлок Ђ</SelectItem>К К К К К К К К К К <SelectItem value="Ѓлок Ѓ" className="text-sm">Ѓлок Ѓ</SelectItem>К К К К К К К К К К <SelectItem value="Ѓлок ‚" className="text-sm">Ѓлок ‚</SelectItem>К К К К К К К К К К <SelectItem value="Ѓлок ѓ" className="text-sm">Ѓлок ѓ</SelectItem>К К К К К К К К К </SelectContent>К К К К К К К К </Select>К К К К К К К </div>К К К К К К К <div>К К К К К К К К <label className="text-xs text-muted-foreground font-semibold">ђЯд</label>К К К К К К К К <InputК К К К К К К К К value={formData.row}К К К К К К К К К onChange={(e) => setFormData({ ...formData, row: e.target.value })}К К К К К К К К К placeholder="ђЯд 12"К К К К К К К К К className="text-sm font-normal placeholder:text-xs placeholder:text-muted-foreground/70 placeholder:font-light"К К К К К К К К />К К К К К К К </div>К К К К К К </div>К К К К К К <div>К К К К К К К <label className="text-xs text-muted-foreground font-semibold">ѓибрид</label>К К К К К К К <Select onValueChange={(value) => setFormData({ ...formData, hybrid: value })}>К К К К К К К К <SelectTrigger className="text-sm">К К К К К К К К К <SelectValue placeholder="‚ыберите гибрид" className="text-xs text-muted-foreground/70 font-light" />К К К К К К К К </SelectTrigger>К К К К К К К К <SelectContent>К К К К К К К К К {hybrids.map((hybrid) => (К К К К К К К К К К <SelectItem key={hybrid} value={hybrid} className="text-sm">К К К К К К К К К К К {hybrid}К К К К К К К К К К </SelectItem>К К К К К К К К К ))}К К К К К К К К </SelectContent>К К К К К К К </Select>К К К К К К </div>К К К К К К <div>К К К К К К К <label className="text-xs text-muted-foreground font-semibold">‡аболевание</label>К К К К К К К <Select onValueChange={(value) => setFormData({ ...formData, disease: value })}>К К К К К К К К <SelectTrigger className="text-sm">К К К К К К К К К <SelectValue placeholder="‚ыберите заболевание" className="text-xs text-muted-foreground/70 font-light" />К К К К К К К К </SelectTrigger>К К К К К К К К <SelectContent>К К К К К К К К К {diseases.map((disease) => (К К К К К К К К К К <SelectItem key={disease} value={disease} className="text-sm">К К К К К К К К К К К {disease}К К К К К К К К К К </SelectItem>К К К К К К К К К ))}К К К К К К К К </SelectContent>К К К К К К К </Select>К К К К К К </div>К К К К К К <div>К К К К К К К <label className="text-xs text-muted-foreground font-semibold">‘тепень поражениЯ</label>К К К К К К К <Select onValueChange={(value) => setFormData({ ...formData, severity: value })}>К К К К К К К К <SelectTrigger className="text-sm">К К К К К К К К К <SelectValue placeholder="‚ыберите степень" className="text-xs text-muted-foreground/70 font-light" />К К К К К К К К </SelectTrigger>К К К К К К К К <SelectContent>К К К К К К К К К {severityLevels.map((level) => (К К К К К К К К К К <SelectItem key={level.value} value={level.value} className="text-sm">К К К К К К К К К К К {level.value}К К К К К К К К К К </SelectItem>К К К К К К К К К ))}К К К К К К К К </SelectContent>К К К К К К К </Select>К К К К К К </div>К К К К К К <div>К К К К К К К <label className="text-xs text-muted-foreground font-semibold">‘татус</label>К К К К К К К <Select value={formData.status} onValueChange={(value) => setFormData({ ...formData, status: value })}>К К К К К К К К <SelectTrigger className="text-sm">К К К К К К К К К <SelectValue />К К К К К К К К </SelectTrigger>К К К К К К К К <SelectContent>К К К К К К К К К <SelectItem value="active" className="text-sm">Ђктивный</SelectItem>К К К К К К К К К <SelectItem value="inactive" className="text-sm">Ќеактивный</SelectItem>К К К К К К К К </SelectContent>К К К К К К К </Select>К К К К К К </div>К К К К К К <div>К К К К К К К <label className="text-xs text-muted-foreground font-semibold">Ћтветственный за решение</label>К К К К К К К <Select onValueChange={(value) => setFormData({ ...formData, responsibleUser: value })}>К К К К К К К К <SelectTrigger className="text-sm">К К К К К К К К К <SelectValue placeholder="‚ыберите пользователЯ" />К К К К К К К К </SelectTrigger>К К К К К К К К <SelectContent>К К К К К К К К К {users.map((user) => (К К К К К К К К К К <SelectItem key={user} value={user} className="text-sm">К К К К К К К К К К К {user}К К К К К К К К К К </SelectItem>К К К К К К К К К ))}К К К К К К К К </SelectContent>К К К К К К К </Select>К К К К К К </div>К К К К К К <div>К К К К К К К <label className="text-xs text-muted-foreground font-semibold">‘писок проблем</label>К К К К К К К <div className="grid grid-cols-2 gap-2 mt-2">К К К К К К К К {commonProblems.map((problem) => (К К К К К К К К К <buttonК К К К К К К К К К key={problem}К К К К К К К К К К type="button"К К К К К К К К К К onClick={() => toggleProblem(problem)}К К К К К К К К К К className={`p-2 text-xs rounded-lg border transition-colors ${К К К К К К К К К К К formData.problemsList.includes(problem)К К К К К К К К К К К К ? 'bg-primary/20 border-primary text-primary'К К К К К К К К К К К К : 'border-muted-foreground/30 hover:border-muted-foreground/50'К К К К К К К К К К }`}К К К К К К К К К >К К К К К К К К К К {problem}К К К К К К К К К </button>К К К К К К К К ))}К К К К К К К </div>К К К К К К </div>К К К К К К <div>К К К К К К К <label className="text-xs text-muted-foreground font-semibold">‡аметки</label>К К К К К К К <TextareaК К К К К К К К value={formData.notes}К К К К К К К К onChange={(e) => setFormData({ ...formData, notes: e.target.value })}К К К К К К К К placeholder="„ополнительнаЯ информациЯ"К К К К К К К К className="text-sm font-normal placeholder:text-xs placeholder:text-muted-foreground/70 placeholder:font-light"К К К К К К К К rows={3}К К К К К К К />К К К К К К </div>К К К К К К {/* Photos section */}К К К К К К <div>К К К К К К К <label className="text-xs text-muted-foreground font-semibold">”отографии</label>К К К К К К К <inputК К К К К К К К type="file"К К К К К К К К accept="image/*"К К К К К К К К multipleК К К К К К К К onChange={handlePhotoUpload}К К К К К К К К className="hidden"К К К К К К К К id="disease-photo-upload"К К К К К К К />К К К К К К К К К К К К К К <div className="grid grid-cols-2 gap-3 mt-2">К К К К К К К К <buttonК К К К К К К К К type="button"К К К К К К К К К onClick={() => document.getElementById('disease-photo-upload')?.click()}К К К К К К К К К className="flex flex-col items-center justify-center h-16 border-2 border-dashed border-muted-foreground/30 rounded-lg hover:border-muted-foreground/50 transition-colors"К К К К К К К К >К К К К К К К К К <Camera size={16} className="text-muted-foreground mb-1" />К К К К К К К К К <span className="text-xs text-muted-foreground/70 font-light">‘делать фото</span>К К К К К К К К </button>К К К К К К К К К К К К К К К К <buttonК К К К К К К К К type="button"К К К К К К К К К onClick={() => document.getElementById('disease-photo-upload')?.click()}К К К К К К К К К className="flex flex-col items-center justify-center h-16 border-2 border-dashed border-muted-foreground/30 rounded-lg hover:border-muted-foreground/50 transition-colors"К К К К К К К К >К К К К К К К К К <Upload size={16} className="text-muted-foreground mb-1" />К К К К К К К К К <span className="text-xs text-muted-foreground/70 font-light">‡агрузить</span>К К К К К К К К </button>К К К К К К К </div>К К К К К К К {formData.photos.length > 0 && (К К К К К К К К <div className="mt-3">К К К К К К К К К <p className="text-xs text-muted-foreground/70 font-light mb-2">К К К К К К К К К К ‡агружено фото: {formData.photos.length}К К К К К К К К К </p>К К К К К К К К К <div className="flex flex-wrap gap-2">К К К К К К К К К К {formData.photos.map((photo, index) => (К К К К К К К К К К К <div key={index} className="relative">К К К К К К К К К К К К <div className="w-12 h-12 bg-muted rounded-lg flex items-center justify-center">К К К К К К К К К К К К К <Camera size={12} className="text-muted-foreground" />К К К К К К К К К К К К </div>К К К К К К К К К К К К <buttonК К К К К К К К К К К К К type="button"К К К К К К К К К К К К К onClick={() => removePhoto(index)}К К К К К К К К К К К К К className="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white rounded-full text-xs flex items-center justify-center"К К К К К К К К К К К К >К К К К К К К К К К К К К ?К К К К К К К К К К К К </button>К К К К К К К К К К К </div>К К К К К К К К К К ))}К К К К К К К К К </div>К К К К К К К К </div>К К К К К К К )}К К К К К К </div>К К К К К К <div className="flex space-x-2 pt-2">К К К К К К К <ButtonК К К К К К К К onClick={handleSubmit}К К К К К К К К className="flex-1 bg-green-600 hover:bg-green-700 text-xs"К К К К К К К >К К К К К К К К ‘охранитьК К К К К К К </Button>К К К К К К К <ButtonК К К К К К К К onClick={() => setShowForm(false)}К К К К К К К К variant="outline"К К К К К К К К className="text-xs"К К К К К К К >К К К К К К К К ЋтменаК К К К К К К </Button>К К К К К К </div>К К К К К </div>К К К К </Card>К К К )}К К К {/* Records list */}К К К <div className="space-y-3">К К К К {records.map((record) => (К К К К К <Card key={record.id} className="p-3">К К К К К К <div className="flex items-start space-x-3">К К К К К К К <div className={`rounded-full p-2 flex-shrink-0 ${К К К К К К К К record.status === 'active' ? 'bg-red-100 dark:bg-red-900/30' : 'bg-gray-100 dark:bg-gray-900/30'К К К К К К К }`}>К К К К К К К К <AlertTriangle className={`${К К К К К К К К К record.status === 'active' ? 'text-red-600 dark:text-red-400' : 'text-gray-500'К К К К К К К К }`} size={16} />К К К К К К К </div>К К К К К К К <div className="flex-1 min-w-0">К К К К К К К К <div className="flex items-start justify-between mb-2">К К К К К К К К К <div>К К К К К К К К К К <h4 className="text-sm">{record.disease}</h4>К К К К К К К К К К <p className="text-xs text-muted-foreground">К К К К К К К К К К К {record.row} Ґ {record.hybrid}К К К К К К К К К К </p>К К К К К К К К К </div>К К К К К К К К К <Badge className={`${getSeverityColor(record.severity)} text-xs`}>К К К К К К К К К К {record.severity}К К К К К К К К К </Badge>К К К К К К К К </div>К К К К К К К К К К К К К К К К {record.notes && (К К К К К К К К К <p className="text-xs text-muted-foreground mb-2">{record.notes}</p>К К К К К К К К )}К К К К К К К К К К К К К К К К <div className="space-y-1 text-xs text-muted-foreground mb-2">К К К К К К К К К {record.createdBy && (К К К К К К К К К К <div className="flex items-center">К К К К К К К К К К К <User size={10} className="mr-1" />К К К К К К К К К К К <span>‘оздал: {record.createdBy}</span>К К К К К К К К К К </div>К К К К К К К К К )}К К К К К К К К К {record.responsibleUser && (К К К К К К К К К К <div className="flex items-center">К К К К К К К К К К К <User size={10} className="mr-1" />К К К К К К К К К К К <span>Ћтветственный: {record.responsibleUser}</span>К К К К К К К К К К </div>К К К К К К К К К )}К К К К К К К К К <div className="flex items-center">К К К К К К К К К К <Calendar size={10} className="mr-1" />К К К К К К К К К К <span>„ата созданиЯ: {record.date}</span>К К К К К К К К К </div>К К К К К К К К </div>К К К К К К К К К К К К К К К К <div className="flex items-center justify-between">К К К К К К К К К <Badge variant={record.status === 'active' ? 'destructive' : 'secondary'} className="text-xs">К К К К К К К К К К {record.status === 'active' ? 'Ђктивный' : 'Ќеактивный'}К К К К К К К К К </Badge>К К К К К К К К К <Button К К К К К К К К К К variant="outline" К К К К К К К К К К size="sm" К К К К К К К К К К className="text-xs"К К К К К К К К К К onClick={() => onViewDetails?.(record)}К К К К К К К К К >К К К К К К К К К К <Eye size={12} className="mr-1" />К К К К К К К К К К ЏодробнееК К К К К К К К К </Button>К К К К К К К К </div>К К К К К К К </div>К К К К К К </div>К К К К К </Card>К К К К ))}К К К </div>К К </div>К );}