ФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ
к разработке ТСД‑интерфейса приёмки товара в магазине

1. Цель и область применения
1.1. Цель
Реализовать на ТСД (терминал сбора данных) интерфейс приёмки товара в магазине, который позволяет сотруднику:
- выбрать документ приёмки;
- поштучно или упаковками отсканировать весь товар;
- при необходимости скорректировать количество;
- зафиксировать расхождения;
- завершить приёмку и передать данные в учётную систему.

1.2. Область применения
Интерфейс используется сотрудниками магазина (кладовщики, товароведы, старшие кассиры) при приёмке:
- поставок от поставщика;
- перемещений со склада/РЦ или другого магазина.

1.3. Ограничения
- Работа ТСД предполагается в онлайн‑режиме с возможностью кратковременной потери связи. Логика офлайн‑буфера не описывается в данном документе и реализуется на уровне движка ТСД.
- Интерфейс должен быть работоспособен на экранах 240×320 и выше (вертикальная ориентация).

2. Общие требования к интерфейсу
2.1. Общие принципы
- Максимум операций выполняется сканированием штрих‑кодов (документа, товаров, мест хранения).
- Все критичные действия (отмена документа, завершение приёмки с расхождениями) требуют подтверждения.
- На каждом экране всегда отображается:
  - заголовок (название операции или документа);
  - идентификатор пользователя (кратко);
  - индикатор синхронизации/состояния связи (минимально: «Онлайн/Оффлайн» или иконка).

2.2. Управление
- Основной способ ввода: сканер штрих‑кода.
- Дополнительный ввод: цифровая клавиатура устройства.
- Обязательные «горячие» кнопки (могут быть привязаны к функциональным клавишам ТСД):
  - F1 / «Назад» – возврат на предыдущий экран;
  - F2 / «Меню» – вызов контекстного меню (если предусмотрено экраном);
  - Enter – подтверждение действия/переход дальше;
  - Esc / «Отмена» – отмена текущего действия/закрытие диалога.

2.3. Отображение ошибок и подсказок
- Ошибки выводятся в верхней части экрана красной строкой или всплывающим диалогом.
- Подсказки по ожидаемому действию (например, «Отсканируйте товар») отображаются всегда в нижней части экрана.

3. Список экранов
E01 – Экран авторизации.
E02 – Главное меню.
E03 – Выбор типа приёмки (опционально может быть объединён с E02).
E04 – Список документов приёмки.
E05 – Карточка документа приёмки (шапка).
E06 – Экран сканирования товара.
E07 – Экран ввода/коррекции количества.
E08 – Экран детализации позиции документа.
E09 – Экран выбора причины расхождения.
E10 – Экран итогов приёмки документа.
E11 – Экран подтверждения критичных действий (универсальный диалог).
E12 – Экран поиска по справочнику товаров (по коду/названию).
E13 – Экран сообщения/ошибки (универсальный диалог).

Ниже описаны требования к каждому экрану, логике переходов и валидации.

4. Описание экранов и логики

4.1. E01 – Экран авторизации
4.1.1. Назначение
Обеспечить вход в систему под учётной записью пользователя.

4.1.2. Элементы экрана
- Заголовок: «Авторизация».
- Поле ввода «Логин».
- Поле ввода «Пароль» (символы маскируются).
- Кнопка «Войти».
- Кнопка «Выход» / «Завершить работу» (закрытие приложения ТСД).

4.1.3. Логика и валидация
- Пользователь должен заполнить «Логин» и «Пароль».
- При нажатии «Войти» выполняется проверка учетных данных на сервере.
- В случае ошибки авторизации:
  - вывести сообщение: «Неверный логин или пароль»;
  - очистить поле «Пароль»;
  - фокус установить в поле «Пароль».
- При успешной авторизации:
  - сохранить идентификатор пользователя в сессии;
  - перейти на экран E02 – Главное меню.

4.1.4. Переходы
- Успешный вход → E02.
- Нажатие «Выход» → выход из приложения (определяется платформой ТСД).

4.2. E02 – Главное меню
4.2.1. Назначение
Предоставить пользователю выбор основных операций, в данном интерфейсе – приёмка товара.

4.2.2. Элементы экрана
- Заголовок: «Главное меню».
- Список пунктов меню (прокручиваемый при необходимости):
  - «Приёмка товара» (обязательный пункт).
  - (Опционально другие операции – не описываются в данном документе).
- Внизу – подсказка: «Выберите операцию и нажмите Enter».

4.2.3. Логика
- По умолчанию курсор на пункте «Приёмка товара».
- При выборе пункта «Приёмка товара» и нажатии Enter → переход на E03 или сразу на E04 (если тип приёмки не требуется выбирать).

4.3. E03 – Выбор типа приёмки (если используется)
4.3.1. Назначение
Определить тип документа, по которому будет выполняться приёмка.

4.3.2. Элементы
- Заголовок: «Тип приёмки».
- Список типов:
  - «Поставка от поставщика»;
  - «Перемещение со склада/РЦ».
- Подсказка: «Выберите тип документа и нажмите Enter».

4.3.3. Логика
- Пользователь выбирает тип приёмки.
- После подтверждения – переход на E04 – список документов, отфильтрованный по выбранному типу.

4.4. E04 – Список документов приёмки
4.4.1. Назначение
Предоставить возможность выбора конкретного документа приёмки.

4.4.2. Элементы экрана
- Заголовок: «Документы приёмки».
- Фильтры/индикаторы (одной строкой):
  - Тип приёмки (если выбран на E03);
  - Статус (по умолчанию «Открытые»).
- Список документов (каждая строка):
  - Номер документа (обязателен);
  - Дата документа;
  - Поставщик / Источник (кратко);
  - Статус (например, «Новый», «В процессе», «Завершён» – по умолчанию выводить только «Новый» и «В процессе»).
- Кнопки/действия:
  - Сканирование штрих‑кода документа (если у документа есть штрих‑код);
  - Вызов фильтра (опционально через F2): «Показать все / только открытые».

4.4.3. Логика и валидация
- При сканировании штрих‑кода документа:
  - Если документ найден и статус позволяет приёмку («Новый», «В процессе»):
    - перейти на E05 (карточка документа).
  - Если документ в статусе «Завершён» или любом, не разрешающем приёмку:
    - показать сообщение (E13) «Документ недоступен для приёмки. Статус: <статус>».
- При выборе документа из списка и нажатии Enter:
  - Аналогичная проверка статуса;
  - При успешной проверке – переход на E05.

4.4.4. Переходы
- Выбор документа → E05.
- «Назад» → E02 или E03 в зависимости от конфигурации.

4.5. E05 – Карточка документа приёмки (шапка)
4.5.1. Назначение
Отобразить основную информацию о выбранном документе и дать возможность перейти к приёмке.

4.5.2. Элементы экрана
- Заголовок: «Документ приёмки».
- Поля:
  - «Номер документа»;
  - «Дата документа»;
  - «Поставщик / Источник»;
  - «Тип документа» (поставка/перемещение);
  - «Статус документа».
- Итоги по документу (кратко):
  - «Позиций в документе: X»;
  - «Сканировано позиций: Y»;
  - «С расхождениями: Z».
- Кнопки/действия:
  - «Начать приёмку» / «Продолжить приёмку» (если уже есть отсканированные позиции);
  - «Отменить документ» (если статус позволяет; опционально, может быть только в десктоп‑части, но предусмотреть возможность вызова диалога E11).

4.5.3. Логика
- При нажатии «Начать/Продолжить приёмку» → переход на E06 – сканирование товара.
- При выборе «Отменить документ» → E11 – подтверждение действия.

4.6. E06 – Экран сканирования товара
4.6.1. Назначение
Основной рабочий экран, на котором происходит сканирование товаров по документу.

4.6.2. Элементы экрана
- Заголовок: «Приёмка товара».
- Информация о документе (2–3 строки):
  - Номер документа;
  - Поставщик/Источник (кратко);
  - Текущий прогресс: «Принято позиций: Y из X».
- Поле «Текущий товар» (информационная зона, обновляется после каждого сканирования):
  - Наименование товара (крупным шрифтом);
  - Штрих‑код;
  - Единица измерения (шт/упаковка и т.п.);
  - Количество по документу;
  - Уже принятое количество;
  - Иконка/признак наличия расхождения по данной позиции (если есть).
- Поле ввода/индикатор «Штрих‑код товара» (текущее сканирование).
- Краткие горячие действия (кнопки или подписи к функциональным клавишам):
  - F2 – «Поиск товара» (переход на E12);
  - F3 – «Список позиций» (переход на E08 со списком);
  - F4 – «Итоги» (переход на E10);
  - F1 – «Назад» (возврат на E05, с подтверждением при незавершённой приёмке).

4.6.3. Логика и валидация при сканировании
- Ожидаемое действие пользователя – сканирование штрих‑кода товара.
- После сканирования:
  1) Система пытается сопоставить штрих‑код с позицией документа:
     - Если соответствующая позиция найдена:
       - Определить тип товара:
         - обычный (без серий и партий);
         - с обязательным учётом срока годности/партии (если включено в справочнике, логика поиска атрибута задаётся вне этого документа);
       - Перейти на E07 – ввод/подтверждение количества, передав найденную позицию.
     - Если в документе несколько позиций с одинаковым штрих‑кодом (теоретически):
       - Показать E08 – список позиций с данным кодом, пользователь выбирает нужную (при выборе → E07).
     - Если позиция с таким штрих‑кодом отсутствует в документе:
       - Показать диалог E13: «Товар с кодом <код> отсутствует в документе. Добавить как сверхдокументное поступление?».
       - Варианты:
         - «Да» – открыть E07 для ввода количества с признаком «вне документа»;
         - «Нет» – вернуться на E06 без изменений.
  2) При ошибочном/некорректном штрих‑коде:
     - Вывести сообщение: «Штрих‑код не распознан»;
     - Оставаться на E06.

4.6.4. Дополнительная логика
- Если по позиции уже достигнуто количество по документу и сканируется ещё одна единица:
  - Показать предупреждение E13: «Количество по документу уже принято полностью. Принять сверх документа?».
  - При подтверждении – отметить позицию как имеющую расхождение (излишек), перейти на E07 для ввода доп. количества.
- При нажатии F3 «Список позиций»:
  - Отобразить E08 с позициями документа и статусом их приёмки.

4.7. E07 – Экран ввода/коррекции количества
4.7.1. Назначение
Ввод или корректировка принимаемого количества по выбранной позиции документа.

4.7.2. Элементы экрана
- Заголовок: «Количество».
- Блок информации о товаре:
  - Наименование товара;
  - Штрих‑код;
  - Единица измерения;
  - Количество по документу;
  - Уже принятое количество (до текущего ввода).
- Поле ввода «Принимаемое количество» (по умолчанию):
  - Если включён режим «один скан = одна единица» – подставить 1;
  - Иначе – пустое, пользователю нужно ввести.
- (Опционально) Поле «Срок годности»/«Партия» – если для товара обязательны эти атрибуты.
- Кнопки/действия:
  - «OK» – подтвердить количество;
  - «Отмена» – вернуться на предыдущий экран без сохранения изменений.

4.7.3. Валидация
- «Принимаемое количество» обязательно для заполнения, должно быть > 0.
- Дополнительные проверки:
  - Если введённое количество + ранее принятое > количества по документу:
    - Зафиксировать расхождение типа «Излишек» для данной позиции.
    - Система может запросить подтверждение (E11) в зависимости от настроек:
      - «Количество превышает документное на N. Продолжить?».
  - Если введённое количество < количества по документу и операция завершения по позиции (например, пользователь явно завершает позицию):
    - Зафиксировать расхождение типа «Недостача».
- При обязательном вводе партии/срока годности:
  - Поле «Срок годности/Партия» обязательно для заполнения; формат и валидация формата – на стороне движка/бэкэнда.

4.7.4. Сохранение и переходы
- При успешной валидации:
  - Сохранить введённое количество в черновик приёмки (локально или сразу на сервер – на усмотрение архитектуры).
  - Обновить статистику по позиции и документу.
  - Вернуться на E06 (экран сканирования) с обновлённой информацией по «Текущему товару».
- При «Отмена» – перейти обратно на E06 (без изменения количества).

4.8. E08 – Экран детализации позиции документа / список позиций
4.8.1. Назначение
Отобразить список позиций документа с состоянием приёмки и дать возможность выбрать позицию для корректировки или просмотра.

4.8.2. Элементы экрана
- Заголовок: «Позиции документа».
- Строка фильтра (опционально): «Все / Только с расхождениями / Только не принятые».
- Табличный список позиций (для каждой позиции):
  - Краткое наименование товара;
  - Кол‑во по документу;
  - Принятое количество;
  - Признак расхождения (иконка/символ, например «!»);
  - (Опционально) Номер строки документа.
- Подвал: подсказка «Выберите позицию для корректировки (Enter)»; F1 – «Назад».

4.8.3. Логика
- При выборе позиции и нажатии Enter:
  - Переход на карточку выбранной позиции (детальный режим) либо сразу на E07 (ввод количества).
- При нажатии F1 – возврат:
  - Если вызов экрана был из E06 – возврат на E06;
  - Если из E10 – возврат на E10.

4.9. E09 – Экран выбора причины расхождения
4.9.1. Назначение
Позволить пользователю явно указать причину расхождения по позиции или документу (если требуется бизнес‑логикой).

4.9.2. Элементы экрана
- Заголовок: «Причина расхождения».
- Список причин (примеры):
  - «Брак поставщика»;
  - «Недостача при транспортировке»;
  - «Излишек от поставщика»;
  - «Ошибочная отгрузка»;
  - «Иное» (при выборе – можно запросить комментарий в виде свободного текста, если это допускается интерфейсом ТСД).
- Подсказка: «Выберите причину и нажмите Enter».

4.9.3. Логика
- Вызов экрана может происходить:
  - из E07 после фиксации расхождения;
  - из E10 при завершении документа с расхождениями.
- Выбранная причина сохраняется вместе с данными о расхождении.
- После выбора причины:
  - Возврат на вызывающий экран (E07 или E10).

4.10. E10 – Экран итогов приёмки документа
4.10.1. Назначение
Отобразить итоговую информацию по документу и дать возможность завершить приёмку.

4.10.2. Элементы экрана
- Заголовок: «Итоги приёмки».
- Информация по документу:
  - Номер документа;
  - Поставщик/Источник;
  - Тип документа.
- Итоги по позициям:
  - «Всего позиций в документе: X»;
  - «Полностью приняты: A»;
  - «С расхождениями: B»;
  - «Не приняты: C».
- Итоги по количеству (если возможно):
  - «Количество по документу: Kдок»;
  - «Принято фактически: Kфакт».
- Статусы/индикаторы:
  - Если есть не принятые позиции – вывести предупреждение: «В документе есть не принятые позиции».

- Кнопки/действия:
  - «Завершить приёмку»;
  - «Вернуться к сканированию» (E06);
  - (Опционально) «Просмотр позиций» (E08).

4.10.3. Логика и валидация
- При выборе «Завершить приёмку»:
  - Если C (не принятые позиции) > 0:
    - Показать E11 – подтверждение: «Есть не принятые позиции. Завершить приёмку с недостачей?».
  - Если есть позиции с расхождениями и не указаны причины (если причина обязательна):
    - Перейти на E09 для указания причины (по одной или агрегированно – решается бизнес‑правилами, здесь допускается агрегированное указание общей причины).
  - После подтверждения – отправить данные приёмки на сервер.
  - В зависимости от результата:
    - Успех:
      - Обновить статус документа на «Завершён»;
      - Показать диалог E13: «Приёмка документа успешно завершена»;
      - После закрытия диалога – перейти на E04 (список документов).
    - Ошибка (нет связи / ошибка сервера):
      - Показать E13 с текстом ошибки;
      - Оставаться на E10 или E06 (в зависимости от типа ошибки).

4.11. E11 – Экран подтверждения критичных действий (диалог)
4.11.1. Назначение
Универсальный диалог для подтверждения действий, требующих дополнительного согласия пользователя.

4.11.2. Элементы экрана
- Заголовок: «Подтверждение».
- Текст сообщения (передаётся вызывающим экраном), например:
  - «Отменить документ приёмки? Все введённые данные будут потеряны.»
  - «Завершить приёмку с расхождениями?»
- Кнопки:
  - «Да»;
  - «Нет».

4.11.3. Логика
- При нажатии «Да» – выполнение действия (отмена, завершение и т.п.), затем переход на соответствующий экран (например, E04 после отмены документа).
- При нажатии «Нет» – возврат на вызывающий экран без изменений.

4.12. E12 – Экран поиска по справочнику товаров
4.12.1. Назначение
Позволить найти товар для приёмки без сканирования (по коду/артикулу или части наименования).

4.12.2. Элементы экрана
- Заголовок: «Поиск товара».
- Поле ввода «Код/артикул/название».
- Кнопка «Искать».
- Список результатов (максимум N строк на экране):
  - Наименование товара;
  - Штрих‑код;
  - При необходимости – артикул.
- Подсказка: «Введите хотя бы 3 символа и нажмите искать».

4.12.3. Логика
- При вводе запроса длиной < 3 символов – поиск не выполняется, выдаётся подсказка.
- При вводе запроса ≥ 3 символов и нажатии «Искать»:
  - Выполнить запрос к справочнику товаров (на сервер или локально).
  - Отобразить результаты в списке.
- При выборе товара из списка и нажатии Enter:
  - Если товар есть в текущем документе – перейти в E07 по соответствующей позиции документа (ввод количества).
  - Если товара нет в документе – вывести E13: «Товар отсутствует в документе. Добавить как сверхдокументное поступление?» с дальнейшей логикой как в E06.
- При F1 – возврат на E06.

4.13. E13 – Экран сообщения/ошибки
4.13.1. Назначение
Единообразное отображение информационных сообщений и ошибок.

4.13.2. Элементы
- Заголовок:
  - «Ошибка» – для ошибок;
  - «Информация» – для информационных сообщений.
- Текст сообщения (передаётся вызывающим действием).
- Кнопки:
  - «OK» – закрыть диалог;
  - (Опционально) «Подробнее» – если требуется показать технические детали ошибки (для старших пользователей).

4.13.3. Логика
- По «OK» – возврат на вызывающий экран.
- По «Подробнее» – раскрытие дополнительного текста или переход на отдельный экран логов (при наличии).

5. Бизнес‑логика и общие правила валидации

5.1. Правила работы с документом
- Документ может находиться в статусах:
  - «Новый» – приёмка не начата;
  - «В процессе» – есть отсканированные/введённые данные, но документ не завершён;
  - «Завершён» – приёмка завершена, изменения запрещены.
- При первом входе в документ с статусом «Новый» и начале приёмки статус автоматически меняется на «В процессе».
- При завершении приёмки (успешная отправка данных) статус меняется на «Завершён».
- При попытке открыть документ в статусе «Завершён» для приёмки:
  - Отобразить E13 с текстом: «Документ уже завершён. Приёмка невозможна.».

5.2. Правила учёта количества
- Для каждой позиции документа хранятся поля:
  - Количество по документу;
  - Принятое количество;
  - Признак расхождения (да/нет);
  - Вид расхождения (излишек/недостача);
  - (Опционально) Причина расхождения;
  - (Опционально) разрез по партиям/срокам годности.
- При каждом вводе количества (E07) выполняется пересчёт «Принятое количество» и актуализация признаков расхождения.
- При повторном сканировании одной и той же позиции:
  - Принятое количество увеличивается на указанную величину.

5.3. Правила работы с расхождениями
- Расхождение фиксируется, если:
  - Принятое количество > количества по документу – излишек;
  - Принятое количество < количества по документу при фиксации окончательного состояния документа – недостача.
- При наличии расхождений по документу:
  - На E05 и E10 должен отображаться явный индикатор («Есть расхождения»).
- Возможность завершения документа с расхождениями допускается, но требует подтверждения (E11) и, при необходимости, указания причин (E09).

5.4. Общие правила навигации
- С любого экрана, кроме E01, при нажатии F1 «Назад»:
  - Выполняется возврат на предыдущий логический экран;
  - Если есть несохранённые данные (например, пользователь ввёл количество, но не подтвердил) – вывести E11: «Данные не сохранены. Выйти без сохранения?».
- Переход вперёд всегда осуществляется либо через подтверждение (Enter/«OK»), либо после успешного сканирования и валидации.

5.5. Обработка потери связи
- Если при отправке данных при завершении документа нет связи:
  - Отобразить E13: «Нет связи с сервером. Попробуйте позже.»;
  - Данные приёмки должны быть сохранены локально (детали реализации – вне рамок документа);
  - Статус документа может оставаться «В процессе» до успешной отправки.

6. Нефункциональные требования (минимально)
6.1. Производительность
- Обработка одного сканирования штрих‑кода товара (поиск позиции документа и показ E07) – не более 1 секунды при наличии связи с сервером.
- Отображение списка документов или позиций – не более 3 секунд при количестве записей до 500.

6.2. Удобство использования
- Все поля, доступные для ввода, должны быть визуально выделены (рамкой, обратным фоном и т.п.).
- Размер шрифта для наименования товара и ключевой информации должен быть достаточным для комфортного чтения на расстоянии 30–40 см.

6.3. Логирование
- Все ошибки обмена с сервером и критичные ошибки интерфейса должны логироваться (механизм логирования определяется платформой).

7. Результат для разработчика движка ТСД
На основании данного документа разработчик должен реализовать:
- Набор экранов E01–E13 с указанными элементами и навигацией.
- Обработчики событий:
  - сканирование штрих‑кода документа;
  - сканирование штрих‑кода товара;
  - ввод количества и дополнительных атрибутов (партия/срок годности);
  - выбор позиций, причин расхождений, подтверждение действий.
- Логику валидации, описанную в разделах 4 и 5.
- Взаимодействие с сервером/бекэндом для:
  - авторизации пользователя;
  - получения списка документов и их позиций;
  - передачи введённых данных приёмки и изменения статусов документов.

Данный документ является функциональной спецификацией интерфейса приёмки товара на ТСД и может использоваться как база для настройки/разработки экранов на движке ТСД‑интерфейсов.
